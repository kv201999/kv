!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).hotaPlayer=e()}}(function(){var e=1e3,t=6e4,n=36e5,s=24*n;function r(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var i,a={};function o(e){function t(){if(t.enabled){var e=t,n=+new Date,s=n-(i||n);e.diff=s,e.prev=i,e.curr=n,i=n;for(var r=new Array(arguments.length),o=0;o<r.length;o++)r[o]=arguments[o];r[0]=a.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;c++;var s=a.formatters[n];if("function"==typeof s){var i=r[c];t=s.call(e,i),r.splice(c,1),c--}return t}),a.formatArgs.call(e,r),(t.log||a.log||console.log.bind(console)).apply(e,r)}}return t.namespace=e,t.enabled=a.enabled(e),t.useColors=a.useColors(),t.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return a.colors[Math.abs(n)%a.colors.length]}(e),"function"==typeof a.init&&a.init(t),t}(a=a=o.debug=o.default=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},a.disable=function(){a.enable("")},a.enable=function(e){a.save(e),a.names=[],a.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),n=t.length,s=0;s<n;s++)t[s]&&("-"===(e=t[s].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")))},a.enabled=function(e){var t,n;for(t=0,n=a.skips.length;t<n;t++)if(a.skips[t].test(e))return!1;for(t=0,n=a.names.length;t<n;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=function(i,a){a=a||{};var o,c=typeof i;if("string"===c&&i.length>0)return function(r){if(!((r=String(r)).length>100)){var i=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(r);if(i){var a=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*n;case"minutes":case"minute":case"mins":case"min":case"m":return a*t;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(i);if("number"===c&&!1===isNaN(i))return a.long?r(o=i,s,"day")||r(o,n,"hour")||r(o,t,"minute")||r(o,e,"second")||o+" ms":function(r){return r>=s?Math.round(r/s)+"d":r>=n?Math.round(r/n)+"h":r>=t?Math.round(r/t)+"m":r>=e?Math.round(r/e)+"s":r+"ms"}(i);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))},a.names=[],a.skips=[],a.formatters={};var c={};function h(){var e;try{e=c.storage.debug}catch(t){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(c=c=a).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},c.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+c.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var s=0,r=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(s++,"%c"===e&&(r=s))}),e.splice(r,0,n)}},c.save=function(e){try{null==e?c.storage.removeItem("debug"):c.storage.debug=e}catch(t){}},c.load=h,c.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},c.enable(h());var f,u,l=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function d(e,t,n,s){return e.call(s,t[n],n,t)}var m=function(e,t,n){var s,r=0;for(s in null==f&&function(){for(var e in u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=!0,{toString:null})f=!1}(),e)if(!1===d(t,e,s,n))break;if(f)for(var i=e.constructor,a=!!i&&e===i.prototype;(s=u[r++])&&("constructor"===s&&(a||!l(e,s))||e[s]===Object.prototype[s]||!1!==d(t,e,s,n)););},p=function(e){return Object.prototype.toString.call(e).slice(8,-1)},g=function(e,t){return p(e)===t},v=Array.isArray||function(e){return g(e,"Array")},w={};function b(){return b.get()}b.get=Math.random,w=b;var y=function(e,t){return e=null==e?-2147483648:~~e,t=null==t?2147483647:~~t,Math.round(function(e,t){return(e=null==e?-2147483648:e)+((t=null==t?2147483647:t)-e)*w()}(e-.5,t+.499999999999))},k=function(e){var t=1===arguments.length&&v(e)?e:arguments;return t[y(0,t.length-1)]},S="0123456789abcdef".split(""),L=function(e){e=e&&e>0?e:6;for(var t="";e--;)t+=k(S);return t},B=function(e,t,n){m(e,function(s,r){if(l(e,r))return t.call(n,e[r],r,e)})};function F(e,t){this[t]=e}var O=function(e,t){for(var n,s=0,r=arguments.length;++s<r;)null!=(n=arguments[s])&&B(n,F,e);return e},x=function(e){return!!e&&"object"==typeof e&&e.constructor===Object},P=function(e){switch(p(e)){case"Object":return x(s=e)?O({},s):s;case"Array":return e.slice();case"RegExp":return n="",n+=(t=e).multiline?"m":"",n+=t.global?"g":"",n+=t.ignoreCase?"i":"",new RegExp(t.source,n);case"Date":return new Date(+e);default:return e}var t,n,s};var C=function e(t,n){switch(p(t)){case"Object":return function(t,n){if(x(t)){var s={};return B(t,function(t,s){this[s]=e(t,n)},s),s}return n?n(t):t}(t,n);case"Array":return function(t,n){for(var s=[],r=-1,i=t.length;++r<i;)s[r]=e(t[r],n);return s}(t,n);default:return P(t)}},j=function(e){return g(e,"Object")},A=function e(){var t,n,s,r,i=1;for(r=C(arguments[0]);s=arguments[i++];)for(t in s)l(s,t)&&(n=s[t],j(n)&&j(r[t])?r[t]=e(r[t],n):r[t]=C(n));return r},M=/^Implements|Extends|Binds$/,E=function(e,t){for(var n in t)n.match(M)||("function"==typeof t[n]&&t[n].$static?e[n]=t[n]:e.prototype[n]=t[n]);return e},I=/^Implements|Extends|Binds$/,D=function(e){"Function"===p(e)&&(e={initialize:e});var t=e.Extends,n=l(e,"initialize")?e.initialize:t||function(){},s=function(){var t=this;for(var r in e.Binds&&e.Binds.forEach(function(e){var n=t[e];n&&(t[e]=O(t[e].bind(t),n))}),s.prototype){var i=s.prototype[r],a=p(i);r.match(I)||"Function"===a||"GeneratorFunction"==a||(t[r]="Object"==a?A({},t[r]):"Array"==a?i.slice():i)}e.Implements&&e.Implements.forEach(function(e){e.call(t)}),n.apply(this,arguments)};if(t){var r=t.prototype;r.Binds&&(e.Binds=(e.Binds||[]).concat(r.Binds)),r.Implements&&(e.Implements=(e.Implements||[]).concat(r.Implements));var i=s.prototype=function(e,t){function n(){}return n.prototype=e,O(new n,t)}(r);s.parent=r,i.constructor=s}return e.Implements&&("Array"!==p(e.Implements)&&(e.Implements=[e.Implements]),e.Implements.forEach(function(e){E(s,e.prototype)})),E(s,e),e.Binds&&(s.prototype.Binds=e.Binds),e.Implements&&(s.prototype.Implements=e.Implements),s},W=new D({Binds:["on","off","once","emit"],callbacks:{},initialize:function(){this.addEvent=this.on,this.removeListener=this.off,this.removeAllListeners=this.off,this.fireEvent=this.emit},emit:function(e,t){if(this.callbacks[e]){var n=Array.prototype.slice.call(arguments,1);m(this.callbacks[e],function(e){e.apply(null,n)})}},on:function(e,t){if("function"!=typeof t)return console.log("you try to register a non function in ",e);this.callbacks[e]||(this.callbacks[e]={}),this.callbacks[e][L(8)+"-"+L(4)+"-4"+L(3)+"-"+k(8,9,"a","b")+L(3)+"-"+L(12)]=t},once:function(e,t){var n=this,s=function(){n.off(e,s),n.off(e,t)};this.on(e,t),this.on(e,s)},off:function(e,t){e?t?m(this.callbacks[e]||{},function(n,s){n==t&&delete this.callbacks[e][s]},this):this.callbacks[e]={}:this.callbacks={}}}),G={},z="";return(G=(z=c("hotaPlayer"),new D({Implements:[W],initialize:function(e){if(this.div=e.div,this.spinner=e.spinner||function(){},this.transferMemory=e.transferMemory,this.canvasObj={},this.spinnerStatus=!1,this.spinnerPending=!0,this.fps=999,this.last=0,this.interval=1e3/this.fps,this.maxBuffer=e.maxBuffer||1,this.minBuffer=e.minBuffer||.5,this.webgl=!1,!0!==e.disableWebGL){this.webgl=!0;try{window.WebGLRenderingContext&&document.createElement("canvas").getContext("webgl")||(this.webgl=!1)}catch(n){this.webgl=!1}}if(this.webgl?this.renderFrame=this.renderFrameWebGL:this.renderFrame=this.renderFrameRGB,"undefined"!=typeof Worker&&!0!==e.disableWorker){var t=new Worker(e.workerFile||"Decoder.js");this.worker=t,this.workerMaxBuffer=e.workerMaxBuffer||5,this.workerBufferCount=0,this.decodedFrame=[],t.addEventListener("message",e=>{var t=e.data;t.consoleLog?z(t.consoleLog):(this.workerBufferCount-=1,this.postFrameToWorker(),this.decodedFrame.push(t))}),t.postMessage({type:"Broadway.js - Worker init",options:{rgb:!this.webgl}})}else this.avc=new Decoder({rgb:!this.webgl}),this.avc.onPictureDecoded=function(e,t,n){this.renderFrame(e,t,n)}.bind(this);this.ws,this.url,this.framesList,this.callback,e.url&&this.connect(e.url)},frameType:function(e){var t="invalid frame";return e.length>4&&(101==e[4]?t="I frame":65==e[4]?t="P frame":103==e[4]?t="SPS":104==e[4]&&(t="PPS")),t},postFrameToWorker:function(){for(;this.workerMaxBuffer-this.workerBufferCount>0&&this.framesList.length>0;){var e=this.framesList.shift();if(this.workerBufferCount+=1,this.transferMemory)this.worker.postMessage({buf:e.buffer,offset:e.byteOffset},[e.buffer]);else{var t=new Uint8Array(e.length);t.set(e,0,e.length),this.worker.postMessage({buf:t.buffer,offset:0,length:e.length},[t.buffer])}}},addFrame:function(e){var t=this.frameType(e);if(this.worker)if("SPS"===t){if(!this.SPSed)if(this.SPSed=!0,this.transferMemory)this.worker.postMessage({buf:e.buffer,offset:e.byteOffset},[e.buffer]);else{var n=new Uint8Array(e.length);n.set(e,0,e.length),this.worker.postMessage({buf:n.buffer,offset:0,length:e.length},[n.buffer])}}else"PPS"===t&&this.framesList.length+this.workerBufferCount+this.decodedFrame.length>this.fps*this.maxBuffer&&(z("Dropped",this.framesList.length,"Frames"),this.framesList=[]),this.framesList.push(e),this.postFrameToWorker();else this.SPSed||"SPS"!==t?"PPS"===t?(this.framesList.push([e]),(this.framesList.length>2||2===this.framesList.length&&this.framesList[0].length>this.fps*this.maxBuffer)&&(z("Dropped"),this.framesList=[this.framesList[this.framesList.length-1]])):this.framesList[this.framesList.length-1].push(e):(this.SPSed=!0,this.framesList.push([e]))},reconnect:function(){this.ws.reconnect=!1,this.connect(this.url)},connect:function(e){this.spinnerPending=!0,this.startSpinner(),this.url=e,null!=this.ws&&this.disconnect(),this.ws=new WebSocket(e);var t=this.ws;this.ws.binaryType="arraybuffer",this.ws.reconnect=!0,this.ws.onopen=(()=>{this.worker?(this.framesList=[],this.decodedFrame=[]):this.framesList=[[]],this.SPSed=!1,z("Connected to "+e),this.ws.running=!0;var t=function(){if(this.ws.running){requestAnimationFrame(t);var e=Date.now(),n=e-this.last;if(this.worker){if(this.decodedFrame.length>Math.floor(this.fps*this.maxBuffer)-this.workerMaxBuffer)z("decoded drop"),this.decodedFrame.splice(0,this.decodedFrame.length-Math.ceil(this.fps*this.minBuffer));else if(n<this.interval){if(this.decodedFrame.length<Math.ceil(this.fps*this.minBuffer))return void z("waiting",this.decodedFrame.length);z("speed up")}}else if(n<this.interval){var s=this.framesList[0].length;if(this.framesList.length>1&&(s+=this.framesList[1].length),s<this.fps*this.maxBuffer)return void z("waiting",s);z("speed up")}if(this.worker){var r=this.decodedFrame.shift();if(r){this.last=e-n%this.interval;var i=new Uint8Array(r.buf,0,r.length);this.renderFrame(i,r.width,r.height)}else this.checkSpinner()}else{var a=this.framesList[0].shift();a?(this.last=e-n%this.interval,this.avc.decode(a)):this.framesList.length>1&&(this.framesList.shift(),(a=this.framesList[0].shift())?(this.last=e-n%this.interval,this.avc.decode(a)):this.checkSpinner())}}}.bind(this);t()}),this.ws.onmessage=(e=>{if("string"==typeof e.data)return this.cmd(JSON.parse(e.data));this.spinnerPending&&(this.spinnerPending=!1),this.spinnerStatus&&this.stopSpinner();var t=new Uint8Array(e.data);this.addFrame(t)}),this.ws.onclose=(e=>{z("Disconnected",e.code),z("hotaPlayer: Connection closed"),t.reconnect&&(t.running=!1,this.reconnect())}),this.ws.onerror=(e=>{z("error event",e),t.reconnect&&this.reconnect()})},renderFrameWebGL(e,t,n){var s=t*n,r=t/2*(n/2);this.canvasObj.webGLCanvas.drawNextOutputPicture({yData:e.subarray(0,s),uData:e.subarray(s,s+r),vData:e.subarray(s+r,s+r+r)}),this.out+=1},renderFrameRGB(e,t,n){var s=this.canvasObj.ctx,r=this.canvasObj.imgData;s||(this.canvasObj.ctx=this.canvasObj.canvas.getContext("2d"),s=this.canvasObj.ctx,this.canvasObj.imgData=s.createImageData(t,n),r=this.canvasObj.imgData),r.data.set(e),s.putImageData(r,0,0),this.out+=1},initCanvas:function(e,t){this.canvas?this.canvas.width===e&&this.canvas.height===t||(this.canvas.width=e,this.canvas.height=t,this.webgl&&(this.canvasObj.webGLCanvas=new YUVCanvas({canvas:this.canvas,width:e,height:t}))):(this.canvas=document.createElement("canvas"),this.div.appendChild(this.canvas),this.canvasObj.canvas=this.canvas,this.webgl?(this.canvasObj.webGLCanvas=new YUVCanvas({canvas:this.canvas,width:e,height:t}),this.renderFrame=this.renderFrameWebGL):this.renderFrame=this.renderFrameRGB),this.canvas.width=e,this.canvas.height=t},cmd:function(e){z("Incoming request",e),"init"===e.action?(this.SPSed=!1,this.initCanvas(e.width,e.height),this.fps=e.fps||this.fps,this.interval=1e3/this.fps):"data"===e.action&&this.callback&&this.callback(e.data)},disconnect:function(){this.ws&&(z("we close"),this.ws.reconnect=!1,this.ws.close(),delete this.ws)},send:function(e){this.ws.send(JSON.stringify(e))},startSpinner:function(){this.spinnerPending&&(this.spinnerStatus=!0,this.spinner(!0))},stopSpinner:function(){this.spinnerStatus&&(this.spinnerStatus=!1,this.spinner(!1))},checkSpinner:function(){this.spinnerPending=!0,setTimeout(this.startSpinner,500)}}))).debug=c,G});